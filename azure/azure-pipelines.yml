
trigger:
  - master
pr:
  - master

pool:
  vmImage: 'macos-latest'

jobs:
  - job: 'library'
    displayName: 'Build Library'
    steps:
    - task: Cache@2
      inputs:
        key: 'gradle | "$(Agent.OS)" | build.gradle.kts | kermit/**/build.gradle.kts'
        path: '$(Pipeline.Workspace)/.gradle'
        restoreKeys: |
          gradle | "$(Agent.OS)"
          gradle
    - task: Gradle@2
      inputs:
        gradleWrapperFile: 'gradlew'
        options: '--build-cache'
        tasks: 'build'
        publishJUnitResults: true
        testResultsFiles: '**/TEST-*.xml'
        javaHomeOption: 'JDKVersion'
        sonarQubeRunAnalysis: false

    - task: Gradle@2
      inputs:
        gradleWrapperFile: 'gradlew'
        tasks: 'publishToMavenLocal'
        publishJUnitResults: false
        sonarQubeRunAnalysis: false
    - task: Cache@2
      inputs:
        key: 'sampleGradle | "$(Agent.OS)" | KermitSample/**/build.gradle.kts'
        path: '$(Pipeline.Workspace)/KermitSample/.gradle'
        restoreKeys: |
          sampleGradle | "$(Agent.OS)"
          sampleGradle
    - task: Gradle@2
      inputs:
        gradleWrapperFile: 'KermitSample/gradlew'
        workingDirectory: 'KermitSample'
        options: '--build-cache'
        tasks: 'build'
        publishJUnitResults: true
        testResultsFiles: '**/TEST-*.xml'
        javaHomeOption: 'JDKVersion'
        sonarQubeRunAnalysis: false
    - task: Gradle@2
      inputs:
        gradleWrapperFile: 'gradlew'
        options: '--stop'
        tasks: 'build' 
        publishJUnitResults: false
        javaHomeOption: 'JDKVersion'
        sonarQubeRunAnalysis: false
